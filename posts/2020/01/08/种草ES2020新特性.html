<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>种草ES2020新特性 | 前端</title>
    <meta name="description" content="顺丰华东小微">
    <link rel="icon" href="/press/favicon.ico">
    
    <link rel="preload" href="/press/assets/css/0.styles.9aafb69a.css" as="style"><link rel="preload" href="/press/assets/js/app.f58b331f.js" as="script"><link rel="preload" href="/press/assets/js/3.756bb29e.js" as="script"><link rel="preload" href="/press/assets/js/10.bf65750d.js" as="script"><link rel="prefetch" href="/press/assets/js/11.f8c0c803.js"><link rel="prefetch" href="/press/assets/js/12.567ed49f.js"><link rel="prefetch" href="/press/assets/js/13.466efbba.js"><link rel="prefetch" href="/press/assets/js/14.6b2f1720.js"><link rel="prefetch" href="/press/assets/js/15.887c48fe.js"><link rel="prefetch" href="/press/assets/js/16.5ec8906c.js"><link rel="prefetch" href="/press/assets/js/2.ac3a0cc0.js"><link rel="prefetch" href="/press/assets/js/4.c1b77ad3.js"><link rel="prefetch" href="/press/assets/js/5.7e08e063.js"><link rel="prefetch" href="/press/assets/js/6.f204de27.js"><link rel="prefetch" href="/press/assets/js/7.b9de6935.js"><link rel="prefetch" href="/press/assets/js/8.dee108da.js"><link rel="prefetch" href="/press/assets/js/9.7d3948e5.js">
    <link rel="stylesheet" href="/press/assets/css/0.styles.9aafb69a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="post" data-v-a345f0ac><div class="header" data-v-5f7cbcfe data-v-a345f0ac><div class="header-title" data-v-5f7cbcfe>前端</div> <div class="nav" data-v-5f7cbcfe><a href="/press/" class="router-link-active" data-v-5f7cbcfe>文章</a></div></div> <div class="post-content" data-v-a345f0ac><div class="post-title" data-v-a345f0ac>
      种草ES2020新特性
      <p class="date" data-v-a345f0ac><span data-v-a345f0ac>作者: zyh</span> <span data-v-a345f0ac>发布日期：2020-01-08</span> <span data-v-a345f0ac>更新于 2020-1-8 10:46:58 AM</span></p></div> <div class="content content__default" data-v-a345f0ac><p>这几年，Ecma TC39 一年一次更新 ecmascript 规范标准，截止目前，以下特性已进入 finished 状态。现在带大家体验种草 ES2020 新特性。</p> <h2 id="一：promise-allsettled"><a href="#一：promise-allsettled" class="header-anchor">#</a> 一：Promise.allSettled</h2> <h4 id="promise-all-缺陷"><a href="#promise-all-缺陷" class="header-anchor">#</a> Promise.all 缺陷</h4> <p>都知道 Promise.all 具有并发执行异步任务的能力。但它的最大问题就是如果其中某个任务出现异常(reject)，所有任务都会挂掉，Promise 直接进入 reject 状态。</p> <p>想象这个场景：你的页面有三个区域，分别对应三个独立的接口数据，使用 Promise.all 来并发三个接口，如果其中任意一个接口服务异常，状态是 reject,这会导致页面中该三个区域数据全都无法渲染出来，因为任何 reject 都会进入 catch 回调, 很明显，这是无法接受的，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token string">'服务异常'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//如果其中一个任务是 reject，则不会执行到这个回调。</span>
  <span class="token function">RenderContent</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 本例中会执行到这个回调</span>
  <span class="token comment">// error: {code: 500, msg: &quot;服务异常&quot;}})</span>
</code></pre></div><p>我们需要一种机制，如果并发任务中，无论一个任务正常或者异常，都会返回对应的的状态（fulfilled 或者 rejected）与结果（业务 value 或者 拒因 reason），在 then 里面通过 filter 来过滤出想要的业务逻辑结果，这就能最大限度的保障业务当前状态的可访问性，而 Promise.allSettled 就是解决这问题的。</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token string">'服务异常'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">ret</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/*        
  0: {status: &quot;rejected&quot;, reason: {…}}        
  1: {status: &quot;fulfilled&quot;, value: {…}}        
  2: {status: &quot;fulfilled&quot;, value: {…}}    
  */</span>

  <span class="token comment">// 过滤掉 rejected 状态，尽可能多的保证页面区域数据渲染</span>
  <span class="token function">RenderContent</span><span class="token punctuation">(</span>
    ret<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> el<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="二：可选链（optional-chaining）"><a href="#二：可选链（optional-chaining）" class="header-anchor">#</a> 二：可选链（Optional chaining）</h2> <p>可选链 可让我们在查询具有多层级的对象时，不再需要进行冗余的各种前置校验。</p> <p>日常开发中，我们经常会遇到这种查询</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><p>又或是这种</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> age <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info<span class="token punctuation">.</span>getAge <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这是一种丑陋但又不得不做的前置校验，否则很容易命中 Uncaught TypeError: Cannot read property... 这种错误，这极有可能让你整个应用挂掉。</p> <p>用了 Optional Chaining ，上面代码会变成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> user<span class="token operator">?</span><span class="token punctuation">.</span>info<span class="token operator">?</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token keyword">var</span> age <span class="token operator">=</span> user<span class="token operator">?</span><span class="token punctuation">.</span>info<span class="token operator">?</span><span class="token punctuation">.</span>getAge<span class="token operator">?</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可选链中的 ? 表示如果问号左边表达式有值, 就会继续查询问号后面的字段。根据上面可以看出，用可选链可以大量简化类似繁琐的前置校验操作，而且更安全。</p> <h2 id="三：空值合并运算符（nullish-coalescing-operator）"><a href="#三：空值合并运算符（nullish-coalescing-operator）" class="header-anchor">#</a> 三：空值合并运算符（Nullish coalescing Operator）</h2> <p>当我们查询某个属性时，经常会遇到，如果没有该属性就会设置一个默认的值。比如下面代码中查询玩家等级。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>data<span class="token punctuation">.</span>level<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
</code></pre></div><p>在 JS 中，空字符串、0 等，当进行逻辑操作符判时，会自动转化为 false。在上面的代码里，如果玩家等级本身就是 0 级, 变量 level 就会被赋值 暂无等级 字符串，这是逻辑错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> level<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> user<span class="token punctuation">.</span>level <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  level <span class="token operator">=</span> user<span class="token punctuation">.</span>level<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  level <span class="token operator">=</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  level <span class="token operator">=</span> user<span class="token punctuation">.</span>level<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>来看看用空值合并运算符如何处理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// {</span>
<span class="token comment">//   &quot;level&quot;: 0</span>
<span class="token comment">// }</span>
<span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">级</span><span class="token template-punctuation string">`</span></span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
<span class="token comment">// level -&gt; '0级'</span>
</code></pre></div><p>用空值合并运算在逻辑正确的前提下，代码更加简洁。</p> <p>空值合并运算符 与 可选链 相结合，可以很轻松处理多级查询并赋予默认值问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> level <span class="token operator">=</span> user<span class="token punctuation">.</span>data<span class="token operator">?</span><span class="token punctuation">.</span>level <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="四：dynamic-import"><a href="#四：dynamic-import" class="header-anchor">#</a> 四：dynamic-import</h2> <p>按需 import 提案几年前就已提出，如今终于能进入 ES 正式规范。这里个人理解成“按需”更为贴切。现代前端打包资源越来越大，打包成几 M 的 JS 资源已成常态，而往往前端应用初始化时根本不需要全量加载逻辑资源，为了首屏渲染速度更快，很多时候都是按需加载，比如懒加载图片等。而这些按需执行逻辑资源都体现在某一个事件回调中去加载。</p> <div class="language-js extra-class"><pre class="language-js"><code>el<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/path/current-logic.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        
    module<span class="token punctuation">.</span><span class="token function">doSomthing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span><span class="token punctuation">)</span>    
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        
    <span class="token comment">// load error;   </span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，webpack 目前已很好的支持了该特性。</p> <h2 id="五：globalthis"><a href="#五：globalthis" class="header-anchor">#</a> 五：globalThis</h2> <p>Javascript 在不同的环境获取全局对象有不通的方式，node 中通过 global, web 中通过 window, self 等，有些甚至通过 this 获取，但通过 this 是及其危险的，this 在 js 中异常复杂，它严重依赖当前的执行上下文，这些无疑增加了获取全局对象的复杂性。过去获取全局对象，可通过一个全局函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">getGlobal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> self <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> self<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> global <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> global<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unable to locate global object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> globals <span class="token operator">=</span> <span class="token function">getGlobal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis</span>
</code></pre></div><p>而 globalThis 目的就是提供一种标准化方式访问全局对象，有了 globalThis 后，你可以在任意上下文，任意时刻都能获取到全局对象。</p> <h2 id="六：bigint"><a href="#六：bigint" class="header-anchor">#</a> 六：BigInt</h2> <p>Js 中 Number 类型只能安全的表示-(2^53-1)至 2^53-1 范的值，即 Number.MINSAFEINTEGER 至 Number.MAXSAFEINTEGER，超出这个范围的整数计算或者表示会丢失精度。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> num <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 9007199254740991</span>
num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 9007199254740992// 再次加 +1 后无法正常运算</span>
num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 9007199254740992// 两个不同的值，却返回了true</span>
<span class="token number">9007199254740992</span> <span class="token operator">===</span> <span class="token number">9007199254740993</span>  <span class="token comment">// -&gt; true</span>
</code></pre></div><p>为解决此问题，ES2020 提供一种新的数据类型：BigInt。使用 BigInt 有两种方式：</p> <h4 id="在整数字面量后面加-n。"><a href="#在整数字面量后面加-n。" class="header-anchor">#</a> 在整数字面量后面加 n。</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bigIntNum <span class="token operator">=</span> <span class="token number">9007199254740993n</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="使用-bigint-函数。"><a href="#使用-bigint-函数。" class="header-anchor">#</a> 使用 BigInt 函数。</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bigIntNum <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">9007199254740</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> anOtherBigIntNum <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token string">'9007199254740993'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过 BigInt， 我们可以安全的进行大数整型计算。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bigNumRet <span class="token operator">=</span> <span class="token number">9007199254740993n</span> <span class="token operator">+</span> <span class="token number">9007199254740993n</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; -&gt; 18014398509481986n</span>
bigNumRet<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; '18014398509481986'</span>
</code></pre></div><p>注意:</p> <p>BigInt 是一种新的数据原始（primitive）类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token number">9007199254740993n</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 'bigint'</span>
</code></pre></div><p>尽可能避免通过调用函数 BigInt 方式来实例化超大整型。因为参数的字面量实际也是 Number 类型的一次实例化，超出安全范围的数字，可能会引起精度丢失。</p> <h2 id="七：string-prototype-matchall"><a href="#七：string-prototype-matchall" class="header-anchor">#</a> 七：String.prototype.matchAll</h2> <p>思考下面代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;\w+&gt;(.*?)&lt;\/\w+&gt;/g</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// -&gt; [&quot;&lt;text&gt;JS&lt;/text&gt;&quot;, &quot;&lt;text&gt;正则&lt;/text&gt;&quot;]</span>
</code></pre></div><p>可以看出返回的数组里包含了父匹配项，但未匹配到子项（group）。移除全局搜索符“g”试试。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;'</span><span class="token punctuation">;</span> 
<span class="token comment">// 注意这里没有全局搜素标示符“g”</span>
<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;\w+&gt;(.*?)&lt;\/\w+&gt;/</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上面会打印出</span>
<span class="token comment">/*
[    
  &quot;&lt;text&gt;JS&lt;/text&gt;&quot;,    
  &quot;JS&quot;,    
  index: 0,    
  input:    
  &quot;&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;&quot;,    
  groups: undefined
]
*/</span>
</code></pre></div><p>这样可以获取到匹配的父项，包括子项（group），但只能获取到第一个满足的匹配字符。能看出上面无法匹配到 <code>正则</code>。</p> <p>如果获取到全局所有匹配项，包括子项呢？</p> <p>ES2020 提供了一种简易的方式：String.prototype.matchAll, 该方法会返回一个迭代器。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> allMatchs <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex">/&lt;\w+&gt;(.*?)&lt;\/\w+&gt;/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> match <span class="token keyword">of</span> allMatchs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*第一次迭代返回：
[    
  &quot;&lt;text&gt;JS&lt;/text&gt;&quot;,   
  &quot;JS&quot;,  
  index: 0,   
  input: &quot;&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;&quot;,   
  groups: undefined
]
第二次迭代返回：
[  
  &quot;&lt;text&gt;正则&lt;/text&gt;&quot;,   
  &quot;正则&quot;,   
  index: 15,  
  input: &quot;&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;&quot;,    
  groups: undefined
]
*/</span>
</code></pre></div><p>能看出每次迭代中可获取所有的匹配，以及本次匹配的成功的一些其他元信息。</p></div> <div class="post-anchor" data-v-a345f0ac><div data-v-a345f0ac><div><div class="ant-anchor-wrapper" style="max-height:calc(100vh - 100px);"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#一：promise-allsettled" title="一：Promise.allSettled" class="ant-anchor-link-title">一：Promise.allSettled</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#二：可选链（optional-chaining）" title="二：可选链（Optional chaining）" class="ant-anchor-link-title">二：可选链（Optional chaining）</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#三：空值合并运算符（nullish-coalescing-operator）" title="三：空值合并运算符（Nullish coalescing Operator）" class="ant-anchor-link-title">三：空值合并运算符（Nullish coalescing Operator）</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#四：dynamic-import" title="四：dynamic-import" class="ant-anchor-link-title">四：dynamic-import</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#五：globalthis" title="五：globalThis" class="ant-anchor-link-title">五：globalThis</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#六：bigint" title="六：BigInt" class="ant-anchor-link-title">六：BigInt</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#七：string-prototype-matchall" title="七：String.prototype.matchAll" class="ant-anchor-link-title">七：String.prototype.matchAll</a></div></div></div></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/press/assets/js/app.f58b331f.js" defer></script><script src="/press/assets/js/3.756bb29e.js" defer></script><script src="/press/assets/js/10.bf65750d.js" defer></script>
  </body>
</html>
