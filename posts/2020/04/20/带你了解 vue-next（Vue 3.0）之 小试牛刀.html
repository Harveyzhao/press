<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>带你了解 vue-next（Vue 3.0）之 小试牛刀 | 前端</title>
    <meta name="description" content="顺丰华东小微">
    <link rel="icon" href="/press/favicon.ico">
    
    <link rel="preload" href="/press/assets/css/0.styles.9aafb69a.css" as="style"><link rel="preload" href="/press/assets/js/app.f58b331f.js" as="script"><link rel="preload" href="/press/assets/js/3.756bb29e.js" as="script"><link rel="preload" href="/press/assets/js/15.887c48fe.js" as="script"><link rel="prefetch" href="/press/assets/js/10.bf65750d.js"><link rel="prefetch" href="/press/assets/js/11.f8c0c803.js"><link rel="prefetch" href="/press/assets/js/12.567ed49f.js"><link rel="prefetch" href="/press/assets/js/13.466efbba.js"><link rel="prefetch" href="/press/assets/js/14.6b2f1720.js"><link rel="prefetch" href="/press/assets/js/16.5ec8906c.js"><link rel="prefetch" href="/press/assets/js/2.ac3a0cc0.js"><link rel="prefetch" href="/press/assets/js/4.c1b77ad3.js"><link rel="prefetch" href="/press/assets/js/5.7e08e063.js"><link rel="prefetch" href="/press/assets/js/6.f204de27.js"><link rel="prefetch" href="/press/assets/js/7.b9de6935.js"><link rel="prefetch" href="/press/assets/js/8.dee108da.js"><link rel="prefetch" href="/press/assets/js/9.7d3948e5.js">
    <link rel="stylesheet" href="/press/assets/css/0.styles.9aafb69a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="post" data-v-a345f0ac><div class="header" data-v-5f7cbcfe data-v-a345f0ac><div class="header-title" data-v-5f7cbcfe>前端</div> <div class="nav" data-v-5f7cbcfe><a href="/press/" class="router-link-active" data-v-5f7cbcfe>文章</a></div></div> <div class="post-content" data-v-a345f0ac><div class="post-title" data-v-a345f0ac>
      带你了解 vue-next（Vue 3.0）之 小试牛刀
      <p class="date" data-v-a345f0ac><span data-v-a345f0ac>作者: zyh</span> <span data-v-a345f0ac>发布日期：2020-04-20</span> <span data-v-a345f0ac>更新于 2020-4-20 1:44:05 PM</span></p></div> <div class="content content__default" data-v-a345f0ac><p>看完上一章 <code>初入茅庐</code>之后，相信大家已经对<a href="https://github.com/vuejs/vue-next" target="_blank" rel="noopener noreferrer">vue-next（Vue 3.0）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有所了解了。本章带你掌握 <code>vue-next</code> 函数式的 API，了解这些的话，无论是对于源码的阅读，还是当正式版发布时开始学习，应该都会有起到一定的辅助作用。</p> <h2 id="基本例子"><a href="#基本例子" class="header-anchor">#</a> 基本例子</h2> <p>直接拷贝下面代码，去运行看效果吧。推荐使用高版本的 chrome 浏览器，记得打开 F12 调试工具哦！</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://s1.zhuanstatic.com/common/js/vue-next-3.0.0-alpha.0.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> createApp<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> effect <span class="token punctuation">}</span> <span class="token operator">=</span> Vue

  <span class="token keyword">function</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX
      y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY
    <span class="token punctuation">}</span>

    Vue<span class="token punctuation">.</span><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    Vue<span class="token punctuation">.</span><span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      age<span class="token punctuation">:</span> Number
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// Composition API 使用的入口</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'props.age'</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
      <span class="token comment">// 定义响应数据</span>
      <span class="token keyword">const</span> state  <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zhuanzhuan'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 使用公共逻辑</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      Vue<span class="token punctuation">.</span><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当组挂载完成'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Vue<span class="token punctuation">.</span><span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据发生更新'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Vue<span class="token punctuation">.</span><span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'组件将要卸载'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">function</span> <span class="token function">changeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'转转'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 创建监视，并得到 停止函数</span>
      <span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">watch state.name：</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// 调用停止函数，清除对应的监视</span>
      <span class="token comment">// stop()</span>

      <span class="token comment">// 观察包装对象</span>
      <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">watch state.name value:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> oldValue:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">effect 触发了! 名字是：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，年龄：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 返回上下文,可以在模板中使用</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// state: Vue.toRefs(state), // 也可以这样写，将 state 上的每个属性，都转化为 ref 形式的响应式数据</span>
        state<span class="token punctuation">,</span>
        x<span class="token punctuation">,</span>
        y<span class="token punctuation">,</span>
        changeName<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=&quot;changeName&quot;&gt;名字是：{{state.name}} 鼠标x: {{x}} 鼠标: {{y}}&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token string">'#app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="设计动机"><a href="#设计动机" class="header-anchor">#</a> 设计动机</h2> <h3 id="逻辑组合与复用"><a href="#逻辑组合与复用" class="header-anchor">#</a> 逻辑组合与复用</h3> <p>组件 API 设计所面对的核心问题之一就是如何组织逻辑，以及如何在多个组件之间抽取和复用逻辑。基于 Vue 2.x 目前的 API 有一些常见的逻辑复用模式，但都或多或少存在一些问题。这些模式包括：</p> <ul><li>Mixins</li> <li>高阶组件 (Higher-order Components, aka HOCs)</li> <li>Renderless Components (基于 scoped slots / 作用域插槽封装逻辑的组件）</li></ul> <p>网络上关于这些模式的介绍很多，这里就不再赘述细节。总体来说，以上这些模式存在以下问题：</p> <ul><li>模版中的数据来源不清晰。举例来说，当一个组件中使用了多个 <code>mixin</code> 的时候，光看模版会很难分清一个属性到底是来自哪一个 <code>mixin</code>。<code>HOC</code> 也有类似的问题。</li> <li>命名空间冲突。由不同开发者开发的 <code>mixin</code> 无法保证不会正好用到一样的属性或是方法名。<code>HOC</code> 在注入的 <code>props</code> 中也存在类似问题。</li> <li>性能。<code>HOC</code> 和 <code>Renderless Components</code> 都需要额外的组件实例嵌套来封装逻辑，导致无谓的性能开销。</li></ul> <p>从以上<code>useMouse</code>例子中可以看到：</p> <ul><li>暴露给模版的属性来源清晰（从函数返回）；</li> <li>返回值可以被任意重命名，所以不存在命名空间冲突；</li> <li>没有创建额外的组件实例所带来的性能损耗。</li></ul> <h3 id="类型推导"><a href="#类型推导" class="header-anchor">#</a> 类型推导</h3> <p><code>vue-next</code> 的一个主要设计目标是增强对 <code>TypeScript</code> 的支持。原本期望通过 <code>Class API</code> 来达成这个目标，但是经过讨论和原型开发，认为 <code>Class</code> 并不是解决这个问题的正确路线，基于 <code>Class</code> 的 <code>API</code> 依然存在类型问题。</p> <p>基于函数的 <code>API</code> 天然对类型推导很友好，因为 <code>TS</code> 对函数的参数、返回值和泛型的支持已经非常完备。更值得一提的是基于函数的 <code>API</code> 在使用 <code>TS</code> 或是原生 <code>JS</code> 时写出来的代码几乎是完全一样的。</p> <h2 id="setup-函数"><a href="#setup-函数" class="header-anchor">#</a> setup() 函数</h2> <p>我们将会引入一个新的组件选项，<code>setup()</code>。顾名思义，这个函数将会是我们 <code>setup</code> 我们组件逻辑的地方，它会在一个组件实例被创建时，初始化了 props 之后调用。它为我们使用 <code>vue-next</code> 的 <code>Composition API</code> 新特性提供了统一的入口。</p> <h3 id="执行时机"><a href="#执行时机" class="header-anchor">#</a> 执行时机</h3> <p><code>setup</code> 函数会在 <code>beforeCreate</code> 之后、<code>created</code> 之前执行。</p> <h3 id="state"><a href="#state" class="header-anchor">#</a> state</h3> <p>声明 <code>state</code> 主要有以下几种类型。</p> <h4 id="基础类型"><a href="#基础类型" class="header-anchor">#</a> 基础类型</h4> <p>基础类型可以通过 <code>ref</code> 这个<code>api</code> 来声明，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>

        <span class="token keyword">function</span> <span class="token function">appendName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>appendName<span class="token punctuation">,</span> msg<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div @click=&quot;appendName&quot;&gt;{{ msg }}&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们知道在 <code>JavaScript</code> 中，原始值类型如 <code>string</code> 和 <code>number</code> 是只有值，没有引用的。如果在一个函数中返回一个字符串变量，接收到这个字符串的代码只会获得一个值，是无法追踪原始变量后续的变化的。</p> <p>因此，包装对象的意义就在于提供一个让我们能够在函数之间以引用的方式传递任意类型值的容器。这有点像 <code>React Hooks</code> 中的 <code>useRef</code> —— 但不同的是 <code>Vue</code> 的包装对象同时还是响应式的数据源。有了这样的容器，我们就可以在封装了逻辑的组合函数中将状态以引用的方式传回给组件。组件负责展示（追踪依赖），组合函数负责管理状态（触发更新）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// x,y 可能被 useMouse() 内部的代码修改从而触发更新</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>包装对象也可以包装非原始值类型的数据，被包装的对象中嵌套的属性都会被响应式地追踪。用包装对象去包装对象或是数组并不是没有意义的：它让我们可以对整个对象的值进行替换 —— 比如用一个 <code>filter</code> 过的数组去替代原数组：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 替代原数组，但引用不变</span>
numbers<span class="token punctuation">.</span>value <span class="token operator">=</span> numbers<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>这里补充一下，在 基础类型 第一个例子中你可能注意到了，虽然 <code>setup()</code> 返回的 <code>msg</code>是一个包装对象，但在模版中我们直接用了 <code></code>这样的绑定，没有用 <code>.value</code>。这是因为当包装对象被暴露给模版渲染上下文，或是被嵌套在另一个响应式对象中的时候，它会被自动展开 <code>(unwrap)</code>为内部的值。</p> <h4 id="引用类型"><a href="#引用类型" class="header-anchor">#</a> 引用类型</h4> <p>引用类型除了可以使用 <code>ref</code> 来声明，也可以直接使用 <code>reactive</code>，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> state  <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zhuanzhuan'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">changeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            state<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'转转'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> changeName<span class="token punctuation">,</span> msg<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=&quot;changeName&quot;&gt;名字是：{{state.name}}&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="接收-props-数据"><a href="#接收-props-数据" class="header-anchor">#</a> 接收 props 数据</h3> <ul><li>在 <code>props</code> 中定义当前组件允许外界传递过来的参数名称：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">:</span> Number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>通过 <code>setup</code> 函数的第一个形参，接收 <code>props</code> 数据：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'props.age'</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>age<span class="token punctuation">)</span>

  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">watch props.age value:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> oldValue:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除此之外，还可以直接通过 <code>watch</code> 方法来观察某个 <code>prop</code> 的变动，这是为什么呢？答案非常简单，就是 <code>props</code>本身在源码中，也是一个被 <code>reactive</code> 包裹后的对象，因此它具有响应性，所以在<code>watch</code> 方法中的回调函数会自动收集依赖，之后当 <code>age</code> 变动时，会自动调用这些回调逻辑。</p> <h3 id="context"><a href="#context" class="header-anchor">#</a> context</h3> <p><code>setup</code> 函数的第二个形参是一个上下文对象，这个上下文对象中包含了一些有用的属性，这些属性在 <code>vue 2.x</code> 中需要通过 <code>this</code> 才能访问到，那我想通过 <code>this</code> 像在 <code>vue2</code> 中访问一些内置属性，怎么办？比如 <code>attrs</code> 或者 <code>emit</code>。我们可以通过 setup 的第二个参数，在 <code>vue-next</code> 中，它们的访问方式如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>attrs<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>slots<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>root<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>emit<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>refs<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：==在 <code>setup()</code> 函数中无法访问到 <code>this</code>==</p> <h2 id="reactive-函数"><a href="#reactive-函数" class="header-anchor">#</a> reactive() 函数</h2> <p><code>reactive()</code> 函数接收一个普通对象，返回一个响应式的数据对象。</p> <h3 id="基本语法"><a href="#基本语法" class="header-anchor">#</a> 基本语法</h3> <p>等价于 <code>vue 2.x</code> 中的 <code>Vue.observable()</code>函数，<code>vue 3.x</code> 中提供了 <code>reactive()</code> 函数，用来创建响应式的数据对象，基本代码示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  创建响应式数据对象，得到的 state 类似于 vue 2.x 中 data() 返回的响应式对象</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'zhuanzhuan'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="定义响应式数据供-template-使用"><a href="#定义响应式数据供-template-使用" class="header-anchor">#</a> 定义响应式数据供 template 使用</h3> <ol><li>按需导入 reactive 函数：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
</code></pre></div><ol><li>在 <code>setup()</code> 函数中调用 <code>reactive()</code> 函数，创建响应式数据对象：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token operator">=</span> Vue

<span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> state  <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zhuanzhuan'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
</code></pre></div><ol><li>在<code>template</code> 中访问响应式数据：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>template<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button&gt;名字是：{{name}} &lt;/button&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Value Unwrapping（包装对象的自动展开）</p> <h2 id="ref-函数"><a href="#ref-函数" class="header-anchor">#</a> ref() 函数</h2> <p><code>ref()</code> 函数用来根据给定的值创建一个响应式的数据对象，<code>ref()</code> 函数调用的返回值是一个对象，这个对象上只包含一个 <code>.value</code> 属性。</p> <h3 id="基本语法-2"><a href="#基本语法-2" class="header-anchor">#</a> 基本语法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token comment">// 创建响应式数据对象 age，初始值为 3</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果要访问 ref() 创建出来的响应式数据对象的值，必须通过 .value 属性才可以</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 3</span>
<span class="token comment">// 让 age 的值 +1</span>
age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token comment">// 再次打印 age 的值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 4</span>
</code></pre></div><h3 id="在-template-中访问-ref-创建的响应式数据"><a href="#在-template-中访问-ref-创建的响应式数据" class="header-anchor">#</a> 在 template 中访问 ref 创建的响应式数据</h3> <ol><li>在 <code>setup()</code> 中创建响应式数据：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

     <span class="token keyword">return</span> <span class="token punctuation">{</span>
         age<span class="token punctuation">,</span>
         name<span class="token punctuation">:</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'zhuanzhuan'</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>在 <code>template</code> 中访问响应式数据：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>template<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;名字是：{{name}}，年龄是{{age}}&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在-reactive-对象中访问-ref-创建的响应式数据"><a href="#在-reactive-对象中访问-ref-创建的响应式数据" class="header-anchor">#</a> 在 reactive 对象中访问 ref 创建的响应式数据</h3> <p>当把 <code>ref()</code> 创建出来的响应式数据对象，挂载到 <code>reactive()</code> 上时，会自动把响应式数据对象展开为原始的值，不需通过 <code>.value</code> 就可以直接被访问。</p> <p>换句话说就是当一个包装对象被作为另一个响应式对象的属性引用的时候也会被自动展开例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  age<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 3</span>
state<span class="token punctuation">.</span>age<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 此处不需要通过 .value 就能直接访问原始值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 4</span>
</code></pre></div><p>以上这些关于包装对象的细节可能会让你觉得有些复杂，但实际使用中你只需要记住一个基本的规则：只有当你直接以变量的形式引用一个包装对象的时候才会需要用 .value 去取它内部的值 —— 在模版中你甚至不需要知道它们的存在。</p> <p>==注意：新的 ref 会覆盖旧的 ref，示例代码如下：==</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建 ref 并挂载到 reactive 中</span>
<span class="token keyword">const</span> c1 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  c1<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 再次创建 ref，命名为 c2</span>
<span class="token keyword">const</span> c2 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将 旧 ref c1 替换为 新 ref c2</span>
state<span class="token punctuation">.</span>c1 <span class="token operator">=</span> c2<span class="token punctuation">;</span>
state<span class="token punctuation">.</span>c1<span class="token operator">++</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 0</span>
</code></pre></div><h2 id="isref-函数"><a href="#isref-函数" class="header-anchor">#</a> isRef() 函数</h2> <p><code>isRef()</code> 用来判断某个值是否为 <code>ref()</code> 创建出来的对象；应用场景：当需要展开某个可能为 <code>ref()</code> 创建出来的值的时候，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> isRef <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token keyword">const</span> unwrapped <span class="token operator">=</span> <span class="token function">isRef</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token operator">?</span> foo<span class="token punctuation">.</span>value <span class="token punctuation">:</span> foo<span class="token punctuation">;</span>
</code></pre></div><h2 id="torefs-函数"><a href="#torefs-函数" class="header-anchor">#</a> toRefs() 函数</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> toRefs <span class="token punctuation">}</span> <span class="token operator">=</span> Vue

<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义响应式数据对象</span>
	<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      age<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义页面上可用的事件处理函数</span>
    <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>age<span class="token operator">++</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 在 setup 中返回一个对象供页面使用</span>
    <span class="token comment">// 这个对象中可以包含响应式的数据，也可以包含事件处理函数</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 将 state 上的每个属性，都转化为 ref 形式的响应式数据</span>
      <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 自增的事件处理函数</span>
      increment
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>页面上可以直接访问 setup() 中 return 出来的响应式数据：</p> <div class="language-html extra-class"><pre class="language-html"><code>template:`
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>当前的age值为：{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
`
</code></pre></div><h2 id="computed-函数"><a href="#computed-函数" class="header-anchor">#</a> computed() 函数</h2> <p><code>computed()</code> 用来创建计算属性，<code>computed()</code> 函数的返回值是一个 <code>ref</code> 的实例。使用 <code>computed</code> 之前需要按需导入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
</code></pre></div><h3 id="创建只读的计算属性"><a href="#创建只读的计算属性" class="header-anchor">#</a> 创建只读的计算属性</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token comment">// 创建一个 ref 响应式数据</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 根据 count 的值，创建一个响应式的计算属性 plusOne</span>
<span class="token comment">// 它会根据依赖的 ref 自动计算并返回一个新的 ref</span>
<span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>plusOne<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 2</span>
plusOne<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
</code></pre></div><h3 id="创建可读可写的计算属性"><a href="#创建可读可写的计算属性" class="header-anchor">#</a> 创建可读可写的计算属性</h3> <p>在调用 <code>computed()</code> 函数期间，传入一个包含 <code>get</code> 和 <code>set</code> 函数的对象，可以得到一个可读可写的计算属性，示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token comment">// 创建一个 ref 响应式数据</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个 computed 计算属性</span>
<span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 取值函数</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token comment">// 赋值函数</span>
  <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>value <span class="token operator">=</span> val <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 为计算属性赋值的操作，会触发 set 函数</span>
plusOne<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 set 函数后，count 的值会被更新</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 8</span>
</code></pre></div><h2 id="watch-函数"><a href="#watch-函数" class="header-anchor">#</a> watch() 函数</h2> <p><code>watch()</code> 函数用来监视某些数据项的变化，从而触发某些特定的操作，使用之前需要按需导入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> watch <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
</code></pre></div><h3 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> watch <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义 watch，只要 count 值变化，就会触发 watch 回调</span>
<span class="token comment">// watch 会在创建时会自动调用一次</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出 0</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token comment">// 输出 1</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监视指定的数据源"><a href="#监视指定的数据源" class="header-anchor">#</a> 监视指定的数据源</h3> <p>监视 <code>reactive</code> 类型的数据源：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> watch<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'zhuanzhuan'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监视-ref-类型的数据源："><a href="#监视-ref-类型的数据源：" class="header-anchor">#</a> 监视 ref 类型的数据源：</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token comment">// 定义数据源</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 指定要监视的数据源</span>
<span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监视多个数据源"><a href="#监视多个数据源" class="header-anchor">#</a> 监视多个数据源</h3> <p>监视 reactive 类型的数据源：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token operator">=</span> Vue

onst state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'zhuanzhuan'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// Object.values(toRefs(state)),</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>age<span class="token punctuation">,</span> name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>prevCount<span class="token punctuation">,</span> prevName<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>         <span class="token comment">// 新的 age 值</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>          <span class="token comment">// 新的 name 值</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'------------'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prevCount<span class="token punctuation">)</span>     <span class="token comment">// 旧的 age 值</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prevName<span class="token punctuation">)</span>      <span class="token comment">// 新的 name 值</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    lazy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 在 watch 被创建的时候，不执行回调函数中的代码</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>age<span class="token operator">++</span>
  state<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'转转'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>


</code></pre></div><h3 id="清除监视"><a href="#清除监视" class="header-anchor">#</a> 清除监视</h3> <p>在 <code>setup()</code> 函数内创建的 <code>watch</code> 监视，会在当前组件被销毁的时候自动停止。如果想要明确地停止某个监视，可以调用 <code>watch()</code> 函数的返回值即可，语法如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建监视，并得到 停止函数</span>
<span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用停止函数，清除对应的监视</span>
<span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在-watch-中清除无效的异步任务"><a href="#在-watch-中清除无效的异步任务" class="header-anchor">#</a> 在 watch 中清除无效的异步任务</h3> <p>有时候，当被 <code>watch</code> 监视的值发生变化时，或 <code>watch</code> 本身被 <code>stop</code> 之后，我们期望能够清除那些无效的异步任务，此时，<code>watch</code> 回调函数中提供了一个 <code>cleanup registrator function</code> 来执行清除的工作。这个清除函数会在如下情况下被调用：</p> <ul><li>watch 被重复执行了</li> <li>watch 被强制 stop 了</li></ul> <p>Template 中的代码示例如下：</p> <div class="language-html extra-class"><pre class="language-html"><code>/* template 中的代码 */
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keywords<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>Script 中的代码示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义响应式数据 keywords</span>
<span class="token keyword">const</span> keywords <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步任务：打印用户输入的关键词</span>
<span class="token keyword">const</span> <span class="token function-variable function">asyncPrint</span> <span class="token operator">=</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 延时 1 秒后打印</span>
  <span class="token keyword">return</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 定义 watch 监听</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
  keywords<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">keywords<span class="token punctuation">,</span> prevKeywords<span class="token punctuation">,</span> onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行异步任务，并得到关闭异步任务的 timerId</span>
    <span class="token keyword">const</span> timerId <span class="token operator">=</span> <span class="token function">asyncPrint</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// keywords 发生了变化，或是 watcher 即将被停止.</span>
    <span class="token comment">// 取消还未完成的异步操作。</span>
    <span class="token comment">// 如果 watch 监听被重复执行了，则会先清除上次未完成的异步任务</span>
    <span class="token function">onCleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// watch 刚被创建的时候不执行</span>
  <span class="token punctuation">{</span> lazy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 把 template 中需要的数据 return 出去</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
  keywords<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>之所以要用传入的注册函数来注册清理函数，而不是像 <code>React</code> 的 <code>useEffect</code> 那样直接返回一个清理函数，是因为<code>watcher</code> 回调的返回值在异步场景下有特殊作用。我们经常需要在 <code>watcher</code> 的回调中用 <code>async function</code> 来执行异步操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">watch</span><span class="token punctuation">(</span>getId<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们知道 <code>async function</code> 隐性地返回一个 <code>Promise</code> - 这样的情况下，我们是无法返回一个需要被立刻注册的清理函数的。除此之外，回调返回的 <code>Promise</code> 还会被 <code>Vue</code> 用于内部的异步错误处理。</p> <h3 id="watch-回调的调用时机"><a href="#watch-回调的调用时机" class="header-anchor">#</a> watch 回调的调用时机</h3> <p>默认情况下，所有的 <code>watch</code> 回调都会在当前的 <code>renderer flush</code> 之后被调用。这确保了在回调中 <code>DOM</code> 永远都已经被更新完毕。如果你想要让回调在 <code>DOM</code> 更新之前或是被同步触发，可以使用 flush 选项：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count changed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    flush<span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token comment">// default, fire after renderer flush</span>
    flush<span class="token punctuation">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span> <span class="token comment">// fire right before renderer flush</span>
    flush<span class="token punctuation">:</span> <span class="token string">'sync'</span><span class="token punctuation">,</span> <span class="token comment">// fire synchronously</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="全部的-watch-选项（ts-类型声明）"><a href="#全部的-watch-选项（ts-类型声明）" class="header-anchor">#</a> 全部的 watch 选项（TS 类型声明）</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">WatchOptions</span> <span class="token punctuation">{</span>
  lazy<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  deep<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  flush<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">'pre'</span> <span class="token operator">|</span> <span class="token string">'post'</span> <span class="token operator">|</span> <span class="token string">'sync'</span><span class="token punctuation">;</span>
  onTrack<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">:</span> DebuggerEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  onTrigger<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">:</span> DebuggerEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DebuggerEvent</span> <span class="token punctuation">{</span>
  effect<span class="token punctuation">:</span> ReactiveEffect<span class="token punctuation">;</span>
  target<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  key<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'set'</span> <span class="token operator">|</span> <span class="token string">'add'</span> <span class="token operator">|</span> <span class="token string">'delete'</span> <span class="token operator">|</span> <span class="token string">'clear'</span> <span class="token operator">|</span> <span class="token string">'get'</span> <span class="token operator">|</span> <span class="token string">'has'</span> <span class="token operator">|</span> <span class="token string">'iterate'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>lazy 与 2.x 的 immediate 正好相反</li> <li>deep 与 2.x 行为一致</li> <li>onTrack 和 onTrigger 是两个用于 debug 的钩子，分别在 watcher - 追踪到依赖和依赖发生变化的时候被调用，获得的参数是一个包含了依赖细节的 debugger event。</li></ul> <h2 id="lifecycle-hooks-生命周期函数"><a href="#lifecycle-hooks-生命周期函数" class="header-anchor">#</a> LifeCycle Hooks 生命周期函数</h2> <p>所有现有的生命周期钩子都会有对应的 onXXX 函数（只能在 setup() 中使用）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> onUpdated<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>

<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mounted!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'updated!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// destroyed 调整为 unmounted</span>
    <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unmounted!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>下面的列表，是 <code>vue 2.x</code> 的生命周期函数与新版 <code>Composition API</code> 之间的映射关系：</p> <ul><li><code>beforeCreate</code> -&gt; <code>setup()</code></li> <li><code>created</code> -&gt; <code>setup()</code></li> <li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li> <li><code>mounted</code> -&gt; <code>onMounted</code></li> <li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li> <li><code>updated</code> -&gt; <code>onUpdated</code></li> <li><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code></li> <li><code>destroyed</code> -&gt; <code>onUnmounted</code></li> <li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li></ul> <h2 id="provide-inject"><a href="#provide-inject" class="header-anchor">#</a> provide &amp; inject</h2> <p><code>provide()</code> 和 <code>inject()</code> 可以实现嵌套组件之间的数据传递。这两个函数只能在 <code>setup()</code> 函数中使用。父级组件中使用 <code>provide()</code> 函数向下传递数据；子级组件中使用 <code>inject()</code> 获取上层传递过来的数据。</p> <h3 id="共享普通数据"><a href="#共享普通数据" class="header-anchor">#</a> 共享普通数据</h3> <p><code>App.vue</code> 根组件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>App 根组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LevelOne</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> LevelOne <span class="token keyword">from</span> <span class="token string">'./components/LevelOne'</span><span class="token punctuation">;</span>
  <span class="token comment">// 1. 按需导入 provide</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2. App 根组件作为父级组件，通过 provide 函数向子级组件共享数据（不限层级）</span>
      <span class="token comment">//    provide('要共享的数据名称', 被共享的数据)</span>
      <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'globalColor'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      LevelOne<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>LevelOne.vue</code> 组件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 4. 通过属性绑定，为标签设置字体颜色 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span> themeColor<span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Level One<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LevelTwo</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> LevelTwo <span class="token keyword">from</span> <span class="token string">'./LevelTwo'</span><span class="token punctuation">;</span>
  <span class="token comment">// 1. 按需导入 inject</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2. 调用 inject 函数时，通过指定的数据名称，获取到父级共享的数据</span>
      <span class="token keyword">const</span> themeColor <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'globalColor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 3. 把接收到的共享数据 return 给 Template 使用</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        themeColor<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      LevelTwo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>LevelTwo.vue</code> 组件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 4. 通过属性绑定，为标签设置字体颜色 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span> themeColor<span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Level Two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 1. 按需导入 inject</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2. 调用 inject 函数时，通过指定的数据名称，获取到父级共享的数据</span>
      <span class="token keyword">const</span> themeColor <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'globalColor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 3. 把接收到的共享数据 return 给 Template 使用</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        themeColor<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="共享-ref-响应式数据"><a href="#共享-ref-响应式数据" class="header-anchor">#</a> 共享 ref 响应式数据</h3> <p>如下代码实现了点按钮切换主题颜色的功能，主要修改了 <code>App.vue</code> 组件中的代码，<code>LevelOne.vue</code> 和 <code>LevelTwo.vue</code> 中的代码不受任何改变：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>App 根组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 点击 App.vue 中的按钮，切换子组件中文字的颜色 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>themeColor='red'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>红色<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>themeColor='blue'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>蓝色<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>themeColor='orange'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>橘黄色<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LevelOne</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> LevelOne <span class="token keyword">from</span> <span class="token string">'./components/LevelOne'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> provide<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 定义 ref 响应式数据</span>
      <span class="token keyword">const</span> themeColor <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 把 ref 数据通过 provide 提供的子组件使用</span>
      <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'globalColor'</span><span class="token punctuation">,</span> themeColor<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// setup 中 return 数据供当前组件的 Template 使用</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        themeColor<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      LevelOne<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="template-refs"><a href="#template-refs" class="header-anchor">#</a> template refs</h2> <p>通过 <code>ref()</code> 还可以引用页面上的元素或组件。</p> <h3 id="元素的引用"><a href="#元素的引用" class="header-anchor">#</a> 元素的引用</h3> <p>示例代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>h3Ref<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TemplateRefOne<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 创建一个 DOM 引用</span>
      <span class="token keyword">const</span> h3Ref <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 在 DOM 首次加载完毕之后，才能获取到元素的引用</span>
      <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 为 dom 元素设置字体颜色</span>
        <span class="token comment">// h3Ref.value 是原生DOM对象</span>
        h3Ref<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 把创建的引用 return 出去</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        h3Ref<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="组件的引用"><a href="#组件的引用" class="header-anchor">#</a> 组件的引用</h3> <p><code>TemplateRefOne.vue</code> 中的示例代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>TemplateRefOne<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 4. 点击按钮展示子组件的 count 值 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>showNumber<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取TemplateRefTwo中的count值<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 3. 为组件添加 ref 引用 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TemplateRefTwo</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>comRef<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> TemplateRefTwo <span class="token keyword">from</span> <span class="token string">'./TemplateRefTwo'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1. 创建一个组件的 ref 引用</span>
      <span class="token keyword">const</span> comRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 5. 展示子组件中 count 的值</span>
      <span class="token keyword">const</span> <span class="token function-variable function">showNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// 2. 把创建的引用 return 出去</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        comRef<span class="token punctuation">,</span>
        showNumber<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      TemplateRefTwo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>TemplateRefTwo.vue</code> 中的示例代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span><span class="token punctuation">&gt;</span></span>TemplateRefTwo --- {{count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 3. 点击按钮，让 count 值自增 +1 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count+=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1. 定义响应式的数据</span>
      <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 2. 把响应式数据 return 给 Template 使用</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="createcomponent"><a href="#createcomponent" class="header-anchor">#</a> createComponent</h2> <p>这个函数不是必须的，除非你想要完美结合 <code>TypeScript</code> 提供的类型推断来进行项目的开发。</p> <p>这个函数仅仅提供了类型推断，方便在结合 <code>TypeScript</code> 书写代码时，能为 <code>setup()</code> 中的 <code>props</code> 提供完整的类型推断。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">.</span>foo <span class="token comment">// &lt;- type: string</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>尝鲜 vue3.x 新特性 - CompositionAPI：<a href="https://www.cnblogs.com/liulongbinblogs/p/11649393.html" target="_blank" rel="noopener noreferrer">www.cnblogs.com/liulongbinb…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Vue Function-based API RFC：<a href="https://zhuanlan.zhihu.com/p/68477600" target="_blank" rel="noopener noreferrer">zhuanlan.zhihu.com/p/68477600<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>作者：大转转 FE
链接：https://juejin.im/post/5e947dbfe51d454702460335
来源：掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div> <div class="post-anchor" data-v-a345f0ac><div data-v-a345f0ac><div><div class="ant-anchor-wrapper" style="max-height:calc(100vh - 100px);"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#基本例子" title="基本例子" class="ant-anchor-link-title">基本例子</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#设计动机" title="设计动机" class="ant-anchor-link-title">设计动机</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#逻辑组合与复用" title="逻辑组合与复用" class="ant-anchor-link-title">逻辑组合与复用</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#类型推导" title="类型推导" class="ant-anchor-link-title">类型推导</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#setup-函数" title="setup() 函数" class="ant-anchor-link-title">setup() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#执行时机" title="执行时机" class="ant-anchor-link-title">执行时机</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#state" title="state" class="ant-anchor-link-title">state</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#接收-props-数据" title="接收 props 数据" class="ant-anchor-link-title">接收 props 数据</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#context" title="context" class="ant-anchor-link-title">context</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#reactive-函数" title="reactive() 函数" class="ant-anchor-link-title">reactive() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#基本语法" title="基本语法" class="ant-anchor-link-title">基本语法</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#定义响应式数据供-template-使用" title="定义响应式数据供 template 使用" class="ant-anchor-link-title">定义响应式数据供 template 使用</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#ref-函数" title="ref() 函数" class="ant-anchor-link-title">ref() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#基本语法-2" title="基本语法" class="ant-anchor-link-title">基本语法</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#在-template-中访问-ref-创建的响应式数据" title="在 template 中访问 ref 创建的响应式数据" class="ant-anchor-link-title">在 template 中访问 ref 创建的响应式数据</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#在-reactive-对象中访问-ref-创建的响应式数据" title="在 reactive 对象中访问 ref 创建的响应式数据" class="ant-anchor-link-title">在 reactive 对象中访问 ref 创建的响应式数据</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#isref-函数" title="isRef() 函数" class="ant-anchor-link-title">isRef() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#torefs-函数" title="toRefs() 函数" class="ant-anchor-link-title">toRefs() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#computed-函数" title="computed() 函数" class="ant-anchor-link-title">computed() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#创建只读的计算属性" title="创建只读的计算属性" class="ant-anchor-link-title">创建只读的计算属性</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#创建可读可写的计算属性" title="创建可读可写的计算属性" class="ant-anchor-link-title">创建可读可写的计算属性</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#watch-函数" title="watch() 函数" class="ant-anchor-link-title">watch() 函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#基本用法" title="基本用法" class="ant-anchor-link-title">基本用法</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#监视指定的数据源" title="监视指定的数据源" class="ant-anchor-link-title">监视指定的数据源</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#监视-ref-类型的数据源：" title="监视 ref 类型的数据源：" class="ant-anchor-link-title">监视 ref 类型的数据源：</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#监视多个数据源" title="监视多个数据源" class="ant-anchor-link-title">监视多个数据源</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#清除监视" title="清除监视" class="ant-anchor-link-title">清除监视</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#在-watch-中清除无效的异步任务" title="在 watch 中清除无效的异步任务" class="ant-anchor-link-title">在 watch 中清除无效的异步任务</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#watch-回调的调用时机" title="watch 回调的调用时机" class="ant-anchor-link-title">watch 回调的调用时机</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#全部的-watch-选项（ts-类型声明）" title="全部的 watch 选项（TS 类型声明）" class="ant-anchor-link-title">全部的 watch 选项（TS 类型声明）</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#lifecycle-hooks-生命周期函数" title="LifeCycle Hooks 生命周期函数" class="ant-anchor-link-title">LifeCycle Hooks 生命周期函数</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#provide-inject" title="provide &amp; inject" class="ant-anchor-link-title">provide &amp; inject</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#共享普通数据" title="共享普通数据" class="ant-anchor-link-title">共享普通数据</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#共享-ref-响应式数据" title="共享 ref 响应式数据" class="ant-anchor-link-title">共享 ref 响应式数据</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#template-refs" title="template refs" class="ant-anchor-link-title">template refs</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#元素的引用" title="元素的引用" class="ant-anchor-link-title">元素的引用</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#组件的引用" title="组件的引用" class="ant-anchor-link-title">组件的引用</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#createcomponent" title="createComponent" class="ant-anchor-link-title">createComponent</a></div><div class="anchor-item ant-anchor-link" data-v-a345f0ac><a href="#参考" title="参考" class="ant-anchor-link-title">参考</a></div></div></div></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/press/assets/js/app.f58b331f.js" defer></script><script src="/press/assets/js/3.756bb29e.js" defer></script><script src="/press/assets/js/15.887c48fe.js" defer></script>
  </body>
</html>
